{% load static %}
<!DOCTYPE html>
<html lang="en" data-bs-theme=" " id="htmlPage">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>

    <!--font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
        integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- boostrap css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">


    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Prompt:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <!-- custom css -->
    <link rel="stylesheet" href="{% static 'admin_inventory/styles.css' %}">
    <script src="{% static 'admin_inventory/setTheme.js' %}"></script>

    <!-- favicon -->
    <link rel="shortcut icon" href="{% static 'admin_inventory/assets/bims-favicon.png' %}" type="image/x-icon">
</head>

<body>
    <div class="wrapper">

        <!-- sidemenu component-->
        {% include 'components/sidemenu.html' %}

        <div class="main">

            <!-- navbar component -->
            {% include 'components/navbar.html' %}

            <div id="content-container" class="container mt-3 p-4">

                <div class="d-flex justify-content-start mb-5">
                    <img src="{% static 'admin_inventory/assets/listbooks_page.png' %}" alt="list of books icon"
                        style="width: 2em; height: 2em;">
                    <h4 class="m-0 ps-3">List of Books</h4>
                </div>


                <nav class="navbar navbar-expand-lg bg-body mb-3">
                    <div class="container-fluid">
                        <form class="d-flex" action="{% url 'admin_listbooks' %}" method="GET">
                            {% if collection_filter %}
                            <input type="hidden" name="book-collections" value="{{ collection_filter }}">
                            {% endif %}
                            {% if decimal_start %}
                            <input type="hidden" name="item-decimal-start" value="{{ decimal_start }}">
                            {% endif %}
                            {% if decimal_end %}
                            <input type="hidden" name="item-decimal-end" value="{{ decimal_end }}">
                            {% endif %}
                            {% if year_start %}
                            <input type="hidden" name="year-start" value="{{ year_start }}">
                            {% endif %}
                            {% if year_end %}
                            <input type="hidden" name="year-end" value="{{ year_end }}">
                            {% endif %}
                            <input type="hidden" name="show" value="{{ request.GET.show|default:'10' }}">
                            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search"
                                name="search" value="{{ search_query }}">
                            <button class="btn btn-outline-warning" type="submit">Search</button>
                        </form>

                        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                            data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar"
                            aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>

                        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar"
                            aria-labelledby="offcanvasNavbarLabel">
                            <div class="offcanvas-header">
                                <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Options</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"
                                    aria-label="Close"></button>
                            </div>
                            <div class="offcanvas-body d-flex justify-content-lg-end">
                                <ul class="navbar-nav grid gap-3">
                                    <li class="nav-item d-flex align-items-center">
                                        <form method="get">
                                            <div class="d-flex">
                                                <p class="m-0 me-2">Showing</p>
                                                <select class="show-select text-dark" name="show"
                                                    onchange="this.form.submit()">
                                                    <option value="10" {% if request.GET.show == '10' or not request.GET.show %}selected{% endif %}>10</option>
                                                    <option value="20" {% if request.GET.show == '20' %}selected{% endif %}>20</option>
                                                    <option value="30" {% if request.GET.show == '30' %}selected{% endif %}>30</option>
                                                    <option value="40" {% if request.GET.show == '40' %}selected{% endif %}>40</option>
                                                </select>
                                            </div>
                                        </form>
                                    </li>
                                    <li class="nav-item">
                                        <div class="dropdown">
                                            <a class="btn btn-outline-secondary dropdown-toggle" href="#" role="button"
                                                data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fa-solid fa-filter"></i>
                                                &nbsp;
                                                Filter
                                            </a>
                                            <ul class="dropdown-menu">
                                                <li data-bs-toggle="modal" data-bs-target="#filter-bookcollections"><a
                                                        href="#" class="dropdown-item">By Book Collections</a></li>
                                                <li data-bs-toggle="modal" data-bs-target="#filter-itemcallno"><a
                                                        class="dropdown-item" href="#">By Dewey Decimal No.</a></li>
                                                <li data-bs-toggle="modal" data-bs-target="#filter-copyright"><a
                                                        class="dropdown-item" href="#">By Copyright</a></li>
                                                <li data-bs-toggle="modal" data-bs-target="#filter-customize"><a
                                                        class="dropdown-item" href="#">Customize</a></li>
                                            </ul>
                                        </div>
                                    </li>

                                    <li class="nav-item">
                                        <form action="{% url 'admin_exportbooks' %}" method="POST">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-outline-secondary"><i
                                                    class="fa-solid fa-file-export"></i>&nbsp;&nbsp;Export</button>
                                        </form>
                                    </li>

                                    <li class="nav-item">
                                        <button type="button" class="btn uni-btn" data-bs-toggle="modal"
                                            data-bs-target="#modal-add-book"><i class="fa-solid fa-plus"></i>
                                            &nbsp;Add
                                            New
                                            Book</button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </nav>



                <!-- filter modal - book collection  -->
                <div class="modal fade" id="filter-bookcollections" tabindex="-1"
                    aria-labelledby="filter-bookcollections" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="filter-bookcollections">Filter / By Book Collections
                                </h1>
                                <button type=" button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                </button>
                            </div>
                            <form action="{% url 'admin_listbooks' %}" method="GET">
                                <!-- Preserve search query if it exists -->
                                {% if search_query %}
                                <input type="hidden" name="search" value="{{ search_query }}">
                                {% endif %}
                                <!-- Preserve items per page setting -->
                                <input type="hidden" name="show" value="{{ request.GET.show|default:'10' }}">

                                <div class="modal-body">
                                    <div>
                                        <label for="book-collections" class="form-label mb-2">
                                            Select
                                        </label>
                                        <select class="form-select" name="book-collections">
                                            <option value="">All Collections</option>
                                            <option value="DC" {% if collection_filter == 'DC' %}selected{% endif %}>
                                                Circulations</option>
                                            <option value="DFIL" {% if collection_filter == 'DFIL' %}selected{% endif %}>
                                                Filipiniana</option>
                                            <option value="DRES" {% if collection_filter == 'DRES' %}selected{% endif %}>
                                                Reserve</option>
                                            <option value="DREF" {% if collection_filter == 'DREF' %}selected{% endif %}>
                                                General References</option>
                                            <option value="DFIC" {% if collection_filter == 'DFIC' %}selected{% endif %}>
                                                Fictions</option>
                                            <option value="PER" {% if collection_filter == 'PER' %}selected{% endif %}>
                                                Bound Periodicals</option>
                                            <option value="UR" {% if collection_filter == 'UR' %}selected{% endif %}>
                                                Undergraduate Thesis</option>
                                            <option value="BK" {% if collection_filter == 'BK' %}selected{% endif %}>K-12</option>
                                            <option value="AV-CD" {% if collection_filter == 'AV-CD' %}selected{% endif %}>AV CDs</option>
                                            <option value="AV-DVD" {% if collection_filter == 'AV-DVD' %}selected{% endif %}>AV DVDs</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn uni-btn">Filter</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- filter modal-item call number -->
                <div class="modal fade" id="filter-itemcallno" tabindex="-1" aria-labelledby="filter-itemcallno"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="filter-itemcallno">Filter / By Dewey Decimal No.</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                </button>
                            </div>
                            <form action="{% url 'admin_listbooks' %}" method="GET">
                                <!-- Preserve other filters -->
                                {% if collection_filter %}
                                <input type="hidden" name="book-collections" value="{{ collection_filter }}">
                                {% endif %}
                                {% if search_query %}
                                <input type="hidden" name="search" value="{{ search_query }}">
                                {% endif %}
                                <input type="hidden" name="show" value="{{ request.GET.show|default:'10' }}">

                                <div class="modal-body">
                                    <div class="my-2">
                                        <label for="yearpub" class="form-label mb-2">
                                            Enter Decimal Range
                                        </label>
                                        <div class="d-flex align-items-center grid gap-3">
                                            <input type="number" step="0.01" class="form-control"
                                                id="item-decimal-start" name="item-decimal-start" placeholder="From"
                                                value="{{ decimal_start }}">
                                            <i class="fa-solid fa-minus"></i>
                                            <input type="number" step="0.01" class="form-control" id="item-decimal-end"
                                                name="item-decimal-end" placeholder="To" value="{{ decimal_end }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn uni-btn">Filter</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- filter modal- copyright-->
                <div class="modal fade" id="filter-copyright" tabindex="-1" aria-labelledby="filter-copyright"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="filter-copyright">Filter / By Copyright</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                </button>
                            </div>
                            <form action="{% url 'admin_listbooks' %}" method="GET">
                                <!-- Preserve other filters -->
                                {% if collection_filter %}
                                <input type="hidden" name="book-collections" value="{{ collection_filter }}">
                                {% endif %}
                                {% if decimal_start %}
                                <input type="hidden" name="item-decimal-start" value="{{ decimal_start }}">
                                {% endif %}
                                {% if decimal_end %}
                                <input type="hidden" name="item-decimal-end" value="{{ decimal_end }}">
                                {% endif %}
                                {% if search_query %}
                                <input type="hidden" name="search" value="{{ search_query }}">
                                {% endif %}
                                <input type="hidden" name="show" value="{{ request.GET.show|default:'10' }}">

                                <div class="modal-body">
                                    <div class="my-2">
                                        <label for="yearpub" class="form-label mb-2">
                                            Copyright Range
                                        </label>
                                        <div class="d-flex align-items-center grid gap-3">
                                            <input type="number" class="form-control" id="year-start" name="year-start"
                                                placeholder="From" value="{{ year_start }}">
                                            <i class="fa-solid fa-minus"></i>
                                            <input type="number" class="form-control" id="year-end" name="year-end"
                                                placeholder="To" value="{{ year_end }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn uni-btn">Filter</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- filter modal - customize-->
                <div class="modal fade" id="filter-customize" tabindex="-1" aria-labelledby="filter-customize"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="filter-customize">Filter / Customize</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <form action="{% url 'admin_listbooks' %}" method="GET">
                                <!-- Preserve search and pagination -->
                                {% if search_query %}
                                <input type="hidden" name="search" value="{{ search_query }}">
                                {% endif %}
                                <input type="hidden" name="show" value="{{ request.GET.show|default:'10' }}">

                                <div class="modal-body">
                                    <div class="mb-4">
                                        <label for="book-collections" class="form-label mb-2">Book Collections</label>
                                        <select class="form-select" name="book-collections">
                                            <option value="">All Collections</option>
                                            <option value="DC" {% if collection_filter == 'DC' %}selected{% endif %}>
                                                Circulations</option>
                                            <option value="DFIL" {% if collection_filter == 'DFIL' %}selected{% endif %}>
                                                Filipiniana</option>
                                            <option value="DREF" {% if collection_filter == 'DREF' %}selected{% endif %}>
                                                General References</option>
                                            <option value="DFIC" {% if collection_filter == 'DFIC' %}selected{% endif %}>
                                                Fictions</option>
                                            <option value="PER" {% if collection_filter == 'PER' %}selected{% endif %}>
                                                Bound Periodicals</option>
                                            <option value="UR" {% if collection_filter == 'UR' %}selected{% endif %}>
                                                Undergraduate Thesis</option>
                                            <option value="AV-CD" {% if collection_filter == 'AV-CD' %}selected{% endif %}>AV CDs</option>
                                            <option value="AV-DVD" {% if collection_filter == 'AV-DVD' %}selected{% endif %}>AV DVDs</option>
                                        </select>
                                    </div>

                                    <div class="mb-4">
                                        <label for="item-decimal-start" class="form-label mb-2">Dewey Decimal
                                            Range</label>
                                        <div class="d-flex align-items-center grid gap-3">
                                            <input type="number" step="0.01" class="form-control"
                                                id="item-decimal-start" name="item-decimal-start" placeholder="From"
                                                value="{{ decimal_start }}">
                                            <i class="fa-solid fa-minus"></i>
                                            <input type="number" step="0.01" class="form-control" id="item-decimal-end"
                                                name="item-decimal-end" placeholder="To" value="{{ decimal_end }}">
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label for="year-start" class="form-label mb-2">Copyright Range</label>
                                        <div class="d-flex align-items-center grid gap-3">
                                            <input type="number" class="form-control" id="year-start" name="year-start"
                                                placeholder="From" value="{{ year_start }}">
                                            <i class="fa-solid fa-minus"></i>
                                            <input type="number" class="form-control" id="year-end" name="year-end"
                                                placeholder="To" value="{{ year_end }}">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn uni-btn">Filter</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>


                <!-- modal add book information -->
                <div class="modal fade" id="modal-add-book" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="exampleModalLabel">List
                                    of Books / Add</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <form id="addBookForm" action="{% url 'create_listbooks' %}" method="POST">
                                {% csrf_token %}
                                <div class="modal-body">
                                    <div id="messageContainer" class="alert alert-danger" style="display: none;"></div>

                                    <div class="mb-3">
                                        <label for="book-itemcall" class="form-label">Barcode / Acquisition No.</label>
                                        <input type="text" id="book-itemcall" class="form-control" name="barcode">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-title" class="form-label">Title</label>
                                        <input type="text" id="book-title" class="form-control" name="title">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-subtitle" class="form-label">Subtitle</label>
                                        <input type="text" id="book-subtitle" class="form-control" name="subtitle">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-author" class="form-label">Author(s)</label>
                                        <input type="text" id="book-author" class="form-control" name="author">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-publisher" class="form-label">Publisher</label>
                                        <input type="text" id="book-publisher" class="form-control"
                                            name="publisher_code">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-copyright" class="form-label">Copyright</label>
                                        <input type="text" id="book-copyright" class="form-control"
                                            name="copyrightdate">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-author" class="form-label">Date Accessioned</label>
                                        <input type="text" id="book-author" class="form-control"
                                            name="date_accessioned">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-isbn" class="form-label">ISBN</label>
                                        <input type="text" id="book-isbn" class="form-control" name="isbn">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-ccode" class="form-label">Collection Code</label>
                                        <input type="text" id="book-ccode" class="form-control" name="col_code">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-itype" class="form-label">Itype</label>
                                        <input type="text" id="book-itype" class="form-control" name="itype">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-itemcall" class="form-label">Item Call Number</label>
                                        <input type="text" id="book-itemcall" class="form-control" name="item_call_num">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-copy" class="form-label">Copy Number</label>
                                        <input type="text" id="book-copy" class="form-control" name="copy_num">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-volume" class="form-label">Volume</label>
                                        <input type="text" id="book-volume " class="form-control" name="volume">
                                    </div>


                                    <div class="mb-3">
                                        <label for="book-stmt" class="form-label">Edition Statement</label>
                                        <input type="text" id="book-stmt " class="form-control" name="edition_stmt">
                                    </div>

                                    <div class="mb-3">
                                        <label for="paid-for" class="form-label">Paid For</label>
                                        <input type="text" id="paid-for " class="form-control" name="paidfor">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-price" class="form-label">Price</label>
                                        <input type="text" id="book-price " class="form-control" name="price">
                                    </div>

                                    <div class="mb-3">
                                        <label for="book-seller" class="form-label">Book Seller</label>
                                        <input type="text" id="book-seller " class="form-control" name="bookseller_id">
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- table -->
                <div class="card p-3 card-table">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th scope="col" style="font-weight: 500;">Item Call No.</th>
                                <th scope="col" style="font-weight: 500;">Itype</th>
                                <th scope="col" style="font-weight: 500;">C-Code</th>
                                <th scope="col" style="font-weight: 500;">Title</th>
                                <th scope="col" style="font-weight: 500;">Author</th>
                                <th scope="col" style="font-weight: 500;">Publisher</th>
                                <th scope="col" style="font-weight: 500;">Barcode</th>
                                <th scope="col" style="font-weight: 500;">ISBN</th>
                                <th scope="col" style="font-weight: 500;">Copy No.</th>
                                <th scope="col" style="font-weight: 500;">Volume</th>
                            </tr>
                        </thead>
                        <tbody id="books-container">
                            {% for data in bookData %}
                            <tr data-bs-toggle="modal" data-bs-target="#modal_bookdetails_{{data.id}}">
                                <td class="text-truncate" style="max-width: 150px;">{{ data.item_call_num }}</td>
                                <td class="text-truncate" style="max-width: 150px;">{{ data.itype}}</td>
                                <td class="text-truncate" style="max-width: 150px;">{{ data.col_code }}</td>
                                <td class="text-truncate" style="max-width: 150px;">{{ data.title }}</td>
                                <td class="text-truncate" style="max-width: 150px;">{{ data.author }}</td>
                                <td class="text-truncate" style="max-width: 150px;">{{ data.publisher_code }}</td>
                                <td class="text-truncate" style="max-width: 150px;">{{ data.barcode }}</td>
                                <td class="text-truncate" style="max-width: 150px;">{{ data.isbn }}</td>
                                <td class="text-truncate" style="max-width: 150px;">{{ data.copy_num }}</td>
                                <td class="text-truncate" style="max-width: 150px;">{{ data.volume }}</td>
                            </tr>


                            <!-- Show book details (Modal) -->
                            <div class="modal fade" id="modal_bookdetails_{{data.id}}" tabindex="-1"
                                data-bs-backdrop="static">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <i class="fa-solid fa-book-open"></i>
                                            &nbsp;
                                            &nbsp;
                                            <h6 class="modal-title fs-5">List of Books / Details</h6>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="title">
                                                <span class="d-flex grid gap-1"></span>
                                                <h5 style="font-weight: 400;">{{ data.title }} {{ data.subtitle }}</h5>
                                                </span>
                                            </div>

                                            <div class="author">
                                                <span class="d-flex">
                                                    <p>Author(s): </p>
                                                    &nbsp;
                                                    <div class="author-value">
                                                        <p style="font-weight: 410;">{{ data.author }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="publisher">
                                                <span class="d-flex">
                                                    <p>Publisher: </p>
                                                    &nbsp;
                                                    <div class="publisher-value">
                                                        <p style="font-weight: 410;">{{ data.publisher_code }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="barcode">
                                                <span class="d-flex">
                                                    <p>Barcode: </p>
                                                    &nbsp;
                                                    <div class="barcode-value">
                                                        <p style="font-weight: 410;">{{ data.barcode }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="publication-date">
                                                <span class="d-flex">
                                                    <p>Copyright: </p>
                                                    &nbsp;
                                                    <div class="copyright-value">
                                                        <p style="font-weight: 410;">{{ data.copyrightdate }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="isbn">
                                                <span class="d-flex">
                                                    <p>ISBN: </p>
                                                    &nbsp;
                                                    <div class="isbn-value">
                                                        <p style="font-weight: 410;">{{ data.isbn }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="collection-code">
                                                <span class="d-flex">
                                                    <p>Collection Code: </p>
                                                    &nbsp;
                                                    <div class="cc-value">
                                                        <p style="font-weight: 410;">{{ data.col_code }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="itype">
                                                <span class="d-flex">
                                                    <p>Itype: </p>
                                                    &nbsp;
                                                    <div class="itype-value">
                                                        <p style="font-weight: 410;">{{ data.itype }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="item-call-num">
                                                <span class="d-flex">
                                                    <p>Item Call No.: </p>
                                                    &nbsp;
                                                    <div class="itemcallnum-value">
                                                        <p style="font-weight: 410;">{{ data.item_call_num }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="date-accessioned">
                                                <span class="d-flex">
                                                    <p>Date Accessioned: </p>
                                                    &nbsp;
                                                    <div class="date-accessioned-value">
                                                        <p style="font-weight: 410;">{{ data.date_accessioned }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="copy-num">
                                                <span class="d-flex">
                                                    <p>Copy Number: </p>
                                                    &nbsp;
                                                    <div class="copy-number">
                                                        <p style="font-weight: 410;">{{ data.copy_num }}</p>
                                                    </div>
                                                </span>
                                            </div>


                                            <div class="copy-num">
                                                <span class="d-flex">
                                                    <p>Volume: </p>
                                                    &nbsp;
                                                    <div class="volume-number">
                                                        <p style="font-weight: 410;">{{ data.volume }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="edition-stmt">
                                                <span class="d-flex">
                                                    <p>Edition Statement: </p>
                                                    &nbsp;
                                                    <div class="edition-number">
                                                        <p style="font-weight: 410;">{{ data.edition_stmt }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="paidfor-num">
                                                <span class="d-flex">
                                                    <p>Paid for: </p>
                                                    &nbsp;
                                                    <div class="paidfor-value">
                                                        <p style="font-weight: 410;">{{ data.paidfor }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="price-num">
                                                <span class="d-flex">
                                                    <p>Price: </p>
                                                    &nbsp;
                                                    <div class="price-value">
                                                        <p style="font-weight: 410;">â‚±{{ data.price }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                            <div class="price-num">
                                                <span class="d-flex">
                                                    <p>Book Seller: </p>
                                                    &nbsp;
                                                    <div class="purchased-value">
                                                        <p style="font-weight: 410;">{{ data.bookseller_id }}</p>
                                                    </div>
                                                </span>
                                            </div>

                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-outline-secondary"
                                                onclick="printPage('{% url 'print_bookDetails' data.id %}')">
                                                <i class="fa-solid fa-print"></i>&nbsp; Print
                                            </button>
                                            <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal"
                                                data-bs-target="#modal-delete-book-{{data.id}}">
                                                <i class="fa-solid fa-trash"></i>&nbsp;Delete
                                            </button>
                                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal"
                                                data-bs-target="#modal-edit-book-{{data.id}}">
                                                <i class="fa-solid fa-pen-to-square"></i>&nbsp;Edit
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- modal delete book -->
                            <div class="modal fade" id="modal-delete-book-{{ data.id }}" tabindex="-1"
                                aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="exampleModalLabel">Delete Book</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <form action="{% url 'delete_listbooks' data.id %}" method="POST">
                                            {% csrf_token %}
                                            <div class="modal-body">
                                                Are you sure want to delete this book?
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                    data-bs-dismiss="modal">Cancel</button>
                                                <!-- Changed type="button" to type="submit" -->
                                                <button type="submit" class="btn btn-danger">Delete</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- modal edit book -->
                            <div class="modal fade" id="modal-edit-book-{{data.id}}" tabindex="-1" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="exampleModalLabel">List
                                                of Books / Edit</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <form action="{% url 'update_listbooks' data.id %}" method="POST">
                                            {% csrf_token %}
                                            <div class="modal-body">
                                                <div class="mb-3">
                                                    <label for="book-itemcall" class="form-label">Barcode / Acquisition
                                                        No.</label>
                                                    <input type="text" id="book-itemcall" class="form-control"
                                                        name="barcode" value="{{ data.barcode }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-title" class="form-label">Title</label>
                                                    <input type="text" id="book-title" class="form-control" name="title"
                                                        value="{{ data.title }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-subtitle" class="form-label">Subtitle</label>
                                                    <input type="text" id="book-subtitle" class="form-control"
                                                        name="subtitle" value="{{ data.subtitle }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-author" class="form-label">Author(s)</label>
                                                    <input type="text" id="book-author" class="form-control"
                                                        name="author" value="{{ data.author}}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-publisher" class="form-label">Publisher</label>
                                                    <input type="text" id="book-publisher" class="form-control"
                                                        name="publisher_code" value="{{ data.publisher_code }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-copyright" class="form-label">Copyright</label>
                                                    <input type="text" id="book-copyright" class="form-control"
                                                        name="copyrightdate" value="{{ data.copyrightdate}}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-author" class="form-label">Date Accessioned</label>
                                                    <input type="text" id="book-author" class="form-control"
                                                        name="date_accessioned" value="{{ data.date_accessioned }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-isbn" class="form-label">ISBN</label>
                                                    <input type="text" id="book-isbn" class="form-control" name="isbn"
                                                        value="{{ data.isbn }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-ccode" class="form-label">Collection Code</label>
                                                    <input type="text" id="book-ccode" class="form-control"
                                                        name="col_code" value="{{ data.col_code }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-itype" class="form-label">Itype</label>
                                                    <input type="text" id="book-itype" class="form-control" name="itype"
                                                        value="{{ data.itype }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-itemcall" class="form-label">Item Call
                                                        Number</label>
                                                    <input type="text" id="book-itemcall" class="form-control"
                                                        name="item_call_num" value="{{ data.item_call_num }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-copy" class="form-label">Copy Number</label>
                                                    <input type="text" id="book-copy" class="form-control"
                                                        name="copy_num" value="{{ data.copy_num }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-volume" class="form-label">Volume</label>
                                                    <input type="text" id="book-volume " class="form-control"
                                                        name="volume" value="{{ data.volume }}">
                                                </div>


                                                <div class="mb-3">
                                                    <label for="book-stmt" class="form-label">Edition Statement</label>
                                                    <input type="text" id="book-stmt " class="form-control"
                                                        name="edition_stmt" value="{{ data.edition_stmt}}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="paid-for" class="form-label">Paid For</label>
                                                    <input type="text" id="paid-for " class="form-control"
                                                        name="paidfor" value="{{ data.paidfor}}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-price" class="form-label">Price</label>
                                                    <input type="text" id="book-price " class="form-control"
                                                        name="price" value="{{ data.price }}">
                                                </div>

                                                <div class="mb-3">
                                                    <label for="book-seller" class="form-label">Book Seller</label>
                                                    <input type="text" id="book-seller " class="form-control"
                                                        name="bookseller_id" value="{{ data.bookseller_id}}">
                                                </div>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-toggle="modal"
                                                    data-bs-target="#modal_bookdetails_{{data.id}}">Back</button>
                                                <button type="submit" class="btn btn-primary">Save Changes</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- pagination -->
                <nav>
                    <ul class="pagination justify-content-center mt-4 mb-4 grid gap-2">
                        {% if bookData.has_previous %}
                        <li class="nav-item">
                            <a href="?page=1&show={{ request.GET.show|default:'10' }}&search={{ search_query }}{% if collection_filter %}&book-collections={{ collection_filter }}{% endif %}{% if decimal_start %}&item-decimal-start={{ decimal_start }}{% endif %}{% if decimal_end %}&item-decimal-end={{ decimal_end }}{% endif %}{% if year_start %}&year-start={{ year_start }}{% endif %}{% if year_end %}&year-end={{ year_end }}{% endif %}"
                                class="text-body">&laquo;</a>
                        </li>
                        {% endif %}

                        {% for page_num in bookData.paginator.page_range %}
                            {% if page_num >= current_page|add:'-2' and page_num <= current_page|add:'2' %}
                                {% if page_num == current_page %}
                                    <li class="nav-item">
                                        <a href="?page={{ page_num }}&show={{ request.GET.show|default:'10' }}&search={{ search_query }}{% if collection_filter %}&book-collections={{ collection_filter }}{% endif %}{% if decimal_start %}&item-decimal-start={{ decimal_start }}{% endif %}{% if decimal_end %}&item-decimal-end={{ decimal_end }}{% endif %}{% if year_start %}&year-start={{ year_start }}{% endif %}{% if year_end %}&year-end={{ year_end }}{% endif %}"
                                            class="active text-dark">{{ page_num }}</a>
                                    </li>
                                {% else %}
                                    <li class="nav-item">
                                        <a href="?page={{ page_num }}&show={{ request.GET.show|default:'10' }}&search={{ search_query }}{% if collection_filter %}&book-collections={{ collection_filter }}{% endif %}{% if decimal_start %}&item-decimal-start={{ decimal_start }}{% endif %}{% if decimal_end %}&item-decimal-end={{ decimal_end }}{% endif %}{% if year_start %}&year-start={{ year_start }}{% endif %}{% if year_end %}&year-end={{ year_end }}{% endif %}"
                                            class="text-body">{{ page_num }}</a>
                                    </li>
                                {% endif %}
                            {% endif %}
                        {% endfor %}

                        {% if bookData.has_next %}
                        <li class="nav-item">
                            <a href="?page={{ bookData.paginator.num_pages }}&show={{ request.GET.show|default:'10' }}&search={{ search_query }}{% if collection_filter %}&book-collections={{ collection_filter }}{% endif %}{% if decimal_start %}&item-decimal-start={{ decimal_start }}{% endif %}{% if decimal_end %}&item-decimal-end={{ decimal_end }}{% endif %}{% if year_start %}&year-start={{ year_start }}{% endif %}{% if year_end %}&year-end={{ year_end }}{% endif %}"
                                class="text-body">&raquo;</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>


            </div>
        </div>
        <!-- boostrap js -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
            crossorigin="anonymous"></script>
</body>
<script src="{% static 'admin_inventory/function.js' %}"></script>
<script src="{% static 'admin_inventory/printPDF.js' %}"></script>
<script>
    document.querySelector('.show-select').addEventListener('change', function () {
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('show', this.value);
        if ('{{ search_query }}') {
            urlParams.set('search', '{{ search_query }}');
        }
        if ('{{ collection_filter }}') {
            urlParams.set('book-collections', '{{ collection_filter }}');
        }
        if ('{{ decimal_start }}') {
            urlParams.set('item-decimal-start', '{{ decimal_start }}');
        }
        if ('{{ decimal_end }}') {
            urlParams.set('item-decimal-end', '{{ decimal_end }}');
        }
        if ('{{ year_start }}') {
            urlParams.set('year-start', '{{ year_start }}');
        }
        if ('{{ year_end }}') {
            urlParams.set('year-end', '{{ year_end }}');
        }
        window.location.search = urlParams.toString();
    });


    const hamBurger = document.querySelector(".toggle-btn");

    hamBurger.addEventListener("click", function () {
        document.querySelector("#sidebar").classList.toggle("expand");
    });

</script>


<script>
    document.getElementById('addBookForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const form = this;
        const messageContainer = document.getElementById('messageContainer');
        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    // Show error message
                    messageContainer.textContent = data.error;
                    messageContainer.style.display = 'block';
                } else if (data.success) {
                    // Redirect or refresh on success
                    window.location.reload();
                }
            })
            .catch(error => {
                messageContainer.textContent = 'An error occurred while processing your request.';
                messageContainer.style.display = 'block';
            });
    });
</script>

</html>
